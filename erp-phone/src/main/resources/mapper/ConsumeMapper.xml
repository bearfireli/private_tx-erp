<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.hntxrj.txerp.mapper.ConsumeMapper">
    <!--任务单消耗汇总-->
    <select id="getTaskConsumeList" resultType="com.hntxrj.txerp.vo.TaskConsumeVO">
        select pc.StgId,pc.TaskId, pc.StirId,bi.BuilderName,ei.EPPName,tp.Placing,sum(pc.PanNum) as qty,
        sum(pc.MatV1) as MatV1,sum(pc.MatV2) as MatV2,sum(pc.MatV3) as MatV3,
        sum(pc.MatV4) as MatV4,sum(pc.MatV5) as MatV5,sum(pc.MatV6) as MatV6,
        sum(pc.MatV7) as MatV7, sum(pc.MatV8) as MatV8,sum(pc.MatV9) as MatV9,sum(pc.MatV10) as MatV10,sum(pc.MatV11) as
        MatV11,sum(pc.MatV12) as MatV12,
        sum(pc.MatV13) as MatV13,sum(pc.MatV14) as MatV14,sum(pc.MatV15) as MatV15,sum(pc.MatV16) as
        MatV16,sum(pc.MatV17) as MatV17,sum(pc.MatV18) as MatV18,
        sum(pc.MatV19) as MatV19,sum(pc.MatV20) as MatV20,sum(pc.MatV21) as MatV21,sum(pc.MatV22) as
        MatV22,sum(pc.MatV23) as MatV23,
        sum(pc.MatL1) as MatL1,sum(pc.MatL2) as MatL2,sum(pc.MatL3) as MatL3,sum(pc.MatL4) as MatL4,sum(pc.MatL5) as
        MatL5,sum(pc.MatL6) as MatL6,sum(pc.MatL7) as MatL7,
        sum(pc.MatL8) as MatL8,sum(pc.MatL9) as MatL9,sum(pc.MatL10) as MatL10,sum(pc.MatL11) as MatL11,sum(pc.MatL12)
        as MatL12,sum(pc.MatL13) as MatL13,
        sum(pc.MatL14) as MatL14,sum(pc.MatL15) as MatL15,sum(pc.MatL16) as MatL16,sum(pc.MatL17) as
        MatL17,sum(pc.MatL18) as MatL18,sum(pc.MatL19) as MatL19,
        sum(pc.MatL20) as MatL20,sum(pc.MatL21) as MatL21,sum(pc.MatL22) as MatL22,sum(pc.MatL23) as MatL23
        from PT_ProduceConsume pc
        left join PT_TaskPlan tp on pc.TaskId = tp.TaskId and tp.compid=pc.compid
        left join SM_EPPInfo ei on pc.compid = ei.compid and ei.EPPCode=tp.EPPCode
        left join SM_BuilderInfo bi on pc.compid = bi.compid and bi.BuilderCode=tp.BuilderCode
        where pc.compid = #{compid}
        <if test="taskId != null">
            and pc.taskId like '%'+#{taskId}+'%'
        </if>
        <if test="stgId != null">
            and pc.StgId like '%'+#{stgId}+'%'
        </if>
        <if test="stirId != null">
            and pc.stirId like '%'+#{stirId}+'%'
        </if>
        <if test="vehicleId != null">
            and pc.vehicleId like '%'+#{vehicleId}+'%'
        </if>
        <if test="beginTime != null and endTime != null">
            and pc.produceTime between #{beginTime} and #{endTime}
        </if>
        group by pc.StirId, ei.EPPName,pc.TaskId,pc.StgId,BuilderName,Placing
        order by ei.EPPName desc
    </select>
    <!--每盘配料明细-->
    <select id="getFormulaDetails" resultType="com.hntxrj.txerp.vo.PlatelngredientsVO">
        select pc.StirId,pc.ProduceTime,pc.VehicleID,pc.StgId,pc.TaskId,tp.Placing,pc.PanCode,pc.PanNum as qty,
        sum(pc.MatV1)
        as MatV1,sum(pc.MatV2) as MatV2,sum(pc.MatV3) as MatV3,
        sum(pc.MatV4) as MatV4,sum(pc.MatV5) as MatV5,sum(pc.MatV6) as MatV6,
        sum(pc.MatV7) as MatV7, sum(pc.MatV8) as MatV8,sum(pc.MatV9) as MatV9,sum(pc.MatV10) as MatV10,sum(pc.MatV11) as
        MatV11,sum(pc.MatV12) as MatV12,
        sum(pc.MatV13) as MatV13,sum(pc.MatV14) as MatV14,sum(pc.MatV15) as MatV15,sum(pc.MatV16) as
        MatV16,sum(pc.MatV17) as MatV17,sum(pc.MatV18) as MatV18,
        sum(pc.MatV19) as MatV19,sum(pc.MatV20) as MatV20,sum(pc.MatV21) as MatV21,sum(pc.MatV22) as
        MatV22,sum(pc.MatV23) as MatV23,
        sum(pc.MatL1) as MatL1,sum(pc.MatL2) as MatL2,sum(pc.MatL3) as MatL3,sum(pc.MatL4) as MatL4,sum(pc.MatL5) as
        MatL5,sum(pc.MatL6) as MatL6,sum(pc.MatL7) as MatL7,
        sum(pc.MatL8) as MatL8,sum(pc.MatL9) as MatL9,sum(pc.MatL10) as MatL10,sum(pc.MatL11) as MatL11,sum(pc.MatL12)
        as MatL12,sum(pc.MatL13) as MatL13,
        sum(pc.MatL14) as MatL14,sum(pc.MatL15) as MatL15,sum(pc.MatL16) as MatL16,sum(pc.MatL17) as
        MatL17,sum(pc.MatL18) as MatL18,sum(pc.MatL19) as MatL19,
        sum(pc.MatL20) as MatL20,sum(pc.MatL21) as MatL21,sum(pc.MatL22) as MatL22,sum(pc.MatL23) as MatL23
        from dbo.PT_ProduceConsume pc
        left join PT_TaskPlan tp on pc.TaskId = tp.TaskId and tp.compid=pc.compid
        where pc.compid = #{compid}
        <if test="taskId != null">
            and pc.taskId like '%'+#{taskId}+'%'
        </if>
        <if test="stirId != null">
            and pc.stirId like '%'+#{stirId}+'%'
        </if>
        <if test="stgId != null">
            and pc.StgId like '%'+#{stgId}+'%'
        </if>
        <if test="vehicleId != null">
            and pc.vehicleId like '%'+#{vehicleId}+'%'
        </if>
        <if test="beginTime != null and endTime != null">
            and pc.produceTime between #{beginTime} and #{endTime}
        </if>
        group by
        pc.PanNum,pc.StirId,pc.ProduceTime,pc.VehicleID,pc.StgId,pc.TaskId,tp.Placing,pc.PanCode
        order by pc.ProduceTime desc
    </select>


    <!--标号消耗汇总-->
    <select id="getConsumptionTotal" resultType="com.hntxrj.txerp.vo.ConsumeptionTotalVO">
        select pc.StirId,pt.StgId,sum(pc.PanNum) as qty,
        sum(pc.MatV1)as MatV1,sum(pc.MatV2) as MatV2,sum(pc.MatV3) as MatV3,
        sum(pc.MatV4) as MatV4,sum(pc.MatV5) as MatV5,sum(pc.MatV6) as MatV6,
        sum(pc.MatV7) as MatV7, sum(pc.MatV8) as MatV8,sum(pc.MatV9) as MatV9,sum(pc.MatV10) as MatV10,sum(pc.MatV11) as
        MatV11,sum(pc.MatV12) as MatV12,
        sum(pc.MatV13) as MatV13,sum(pc.MatV14) as MatV14,sum(pc.MatV15) as MatV15,sum(pc.MatV16) as
        MatV16,sum(pc.MatV17) as MatV17,sum(pc.MatV18) as MatV18,
        sum(pc.MatV19) as MatV19,sum(pc.MatV20) as MatV20,sum(pc.MatV21) as MatV21,sum(pc.MatV22) as
        MatV22,sum(pc.MatV23) as MatV23,
        sum(pc.MatL1) as MatL1,sum(pc.MatL2) as MatL2,sum(pc.MatL3) as MatL3,sum(pc.MatL4) as MatL4,sum(pc.MatL5) as
        MatL5,sum(pc.MatL6) as MatL6,sum(pc.MatL7) as MatL7,
        sum(pc.MatL8) as MatL8,sum(pc.MatL9) as MatL9,sum(pc.MatL10) as MatL10,sum(pc.MatL11) as MatL11,sum(pc.MatL12)
        as MatL12,sum(pc.MatL13) as MatL13,
        sum(pc.MatL14) as MatL14,sum(pc.MatL15) as MatL15,sum(pc.MatL16) as MatL16,sum(pc.MatL17) as
        MatL17,sum(pc.MatL18) as MatL18,sum(pc.MatL19) as MatL19,
        sum(pc.MatL20) as MatL20,sum(pc.MatL21) as MatL21,sum(pc.MatL22) as MatL22,sum(pc.MatL23) as MatL23
        from PT_ProduceConsume pc
        left join PT_TaskPlan pt
        on pc.compid =pt.compid and pc.TaskId =pt.TaskId
        where pc.compid = #{compid}
        and pc.RecStatus =1 and pt.RecStatus =1
        <if test="taskId != null">
            and pc.taskId like '%'+#{taskId}+'%'
        </if>
        <if test="stirId != null">
            and pc.stirId like '%'+#{stirId}+'%'
        </if>
        <if test="stgId != null">
            and pc.StgId like '%'+#{stgId}+'%'
        </if>
        <if test="vehicleId != null">
            and pc.vehicleId like '%'+#{vehicleId}+'%'
        </if>
        <if test="beginTime != null and endTime != null">
            and pc.produceTime between #{beginTime} and #{endTime}
        </if>
        group by pc.StirId,pt.StgId
        order by pc.StirId,pt.StgId
    </select>

    <!--标号消耗汇总柱状图-->
    <select id="getConsumptionHistogram" resultType="com.hntxrj.txerp.vo.ConsumptionHistogram">
        select pt.StgId as stgId,sum(pc.PanNum) as num
        from PT_ProduceConsume pc
        left join PT_TaskPlan pt
        on pc.compid =pt.compid and pc.TaskId =pt.TaskId
        where pc.compid = #{compid}
        and pc.RecStatus =1 and pt.RecStatus =1
        <if test="taskId != null">
            and pc.taskId like '%'+#{taskId}+'%'
        </if>
        <if test="stirId != null">
            and pc.stirId like '%'+#{stirId}+'%'
        </if>
        <if test="stgId != null">
            and pc.StgId like '%'+#{stgId}+'%'
        </if>
        <if test="vehicleId != null">
            and pc.vehicleId like '%'+#{vehicleId}+'%'
        </if>
        <if test="beginTime != null and endTime != null">
            and pc.produceTime between #{beginTime} and #{endTime}
        </if>
        group by pt.StgId
        order by pt.StgId
    </select>


    <!--原材料统计汇总-->
    <select id="getMatTotal" resultType="com.hntxrj.txerp.vo.RawCollectVO">
        select pc.StirId,sum(pc.PanNum) as qty,sum(pc.MatV1)
        as MatV1,sum(pc.MatV2) as MatV2,sum(pc.MatV3) as MatV3,
        sum(pc.MatV4) as MatV4,sum(pc.MatV5) as MatV5,sum(pc.MatV6) as MatV6,
        sum(pc.MatV7) as MatV7, sum(pc.MatV8) as MatV8,sum(pc.MatV9) as MatV9,sum(pc.MatV10) as MatV10,sum(pc.MatV11) as
        MatV11,sum(pc.MatV12) as MatV12,
        sum(pc.MatV13) as MatV13,sum(pc.MatV14) as MatV14,sum(pc.MatV15) as MatV15,sum(pc.MatV16) as
        MatV16,sum(pc.MatV17) as MatV17,sum(pc.MatV18) as MatV18,
        sum(pc.MatV19) as MatV19,sum(pc.MatV20) as MatV20,sum(pc.MatV21) as MatV21,sum(pc.MatV22) as
        MatV22,sum(pc.MatV23) as MatV23,
        sum(pc.MatL1) as MatL1,sum(pc.MatL2) as MatL2,sum(pc.MatL3) as MatL3,sum(pc.MatL4) as MatL4,sum(pc.MatL5) as
        MatL5,sum(pc.MatL6) as MatL6,sum(pc.MatL7) as MatL7,
        sum(pc.MatL8) as MatL8,sum(pc.MatL9) as MatL9,sum(pc.MatL10) as MatL10,sum(pc.MatL11) as MatL11,sum(pc.MatL12)
        as MatL12,sum(pc.MatL13) as MatL13,
        sum(pc.MatL14) as MatL14,sum(pc.MatL15) as MatL15,sum(pc.MatL16) as MatL16,sum(pc.MatL17) as
        MatL17,sum(pc.MatL18) as MatL18,sum(pc.MatL19) as MatL19,
        sum(pc.MatL20) as MatL20,sum(pc.MatL21) as MatL21,sum(pc.MatL22) as MatL22,sum(pc.MatL23) as MatL23
        from PT_ProduceConsume pc
        where pc.compid = #{compid}
        <if test="taskId != null and taskId!='' ">
            and pc.taskId like '%'+#{taskId}+'%'
        </if>

        <if test="stirId != null and stirId!='' ">
            and pc.stirId like '%'+#{stirId}+'%'
        </if>

        <if test="stgId != null and stgId!=''">
            and pc.StgId like '%'+#{stgId}+'%'
        </if>

        <if test="vehicleId != null and vehicleId!=''">
            and pc.VehicleId like '%'+#{vehicleId}+'%'
        </if>
        <if test="beginTime != null and endTime != null">
            and pc.produceTime between #{beginTime} and #{endTime}
        </if>
        group by pc.StirId
        order by pc.StirId
    </select>


    <!--生产消耗汇总合计汇总-->
    <select id="getConsumeClose" resultType="com.hntxrj.txerp.vo.ConsumePtionCloseVO">
        select sum(pc.PanNum) as totalNum from PT_ProduceConsume pc
        left join PT_TaskPlan pt
        on pc.compid =pt.compid and pc.TaskId =pt.TaskId
        where pc.compid = #{compid}
        and pc.RecStatus =1 and pt.RecStatus =1
        <if test="taskId != null">
            and pc.taskId like '%'+#{taskId}+'%'
        </if>
        <if test="stirId != null">
            and pc.stirId like '%'+#{stirId}+'%'
        </if>
        <if test="stgId != null">
            and pc.StgId like '%'+#{stgId}+'%'
        </if>
        <if test="vehicleId != null">
            and pc.vehicleId like '%'+#{vehicleId}+'%'
        </if>
        <if test="beginTime != null and endTime != null">
            and pc.produceTime between #{beginTime} and #{endTime}
        </if>
    </select>

    <select id="getProductDatail" resultType="com.hntxrj.txerp.vo.StockVO">
        select mp.StkCode, mp.Sto_Name,mm.MatCode,mm.MatName,mm.MatParent
        from MP_Stock mp
         left join  MP_MaterialInfor mm on mp.compid =mm.compid and mp.MatCode =mm.MatCode
        where mp.compid = #{compid}
          and mp.StirId = #{stirid}
          and mp.RecStatus = 1
        order by mp.OderBy
    </select>


    <!--超差盘数-->
    <select id="getErroPan" resultType="com.hntxrj.txerp.entity.ProductConsume">
        select * from PT_ProduceConsume where compid=#{compid}
        <if test="beginTime != null and endTime != null">
            and produceTime between #{beginTime} and #{endTime}
        </if>
    </select>

</mapper>